{%extends "base.html"%}
{% load materializecss %}
{%block conteudo%}

<main>
    <div class=" row container margin">
        <div class="col s6 offset-s3">
            <div class="card-panel teal">
                <div method="GET" id="gerar-frase" class="center">
                    
                </div>  

                <button method="POST" id="id_feito"class=" center btn waves-effect waves-light left" onclick="functionfeito(2)">feito
                    <i class="material-icons right">send</i>
                </button>  
                <button method="POST" id="id_passa" class=" center btn waves-effect waves-light right"onclick="functionfeito(1)">proximo
                    <i class="material-icons right">send</i>
                </button>
            
            </div>


        </div>
    </div>
    
    

</main>

<script>    
    var nivel = "{{objJogo.nivel_jogo}}";
    var id_jogo = "{{objJogo.id}}";
    const listJogadores = []
    {%for q in listUsuarios%}
        listJogadores.push('{{q.id}}')
    {%endfor%}
    var ultimo = listJogadores.length - 1;
    n = 0
    jogadas = 0
    limite_rodada = 2 * '{{objJogo.qtd_jogadores}}' 
    $(document).ready(function(){  
        getCarta(listJogadores[n]);        
    });    
    function getCarta(jogador){
        $.ajax({
            // o que vai ser enviado ao servidor/ views
            url:'/gerar_frase/',
            data: {
                'nivel': nivel,                
                'user' : jogador,
                'id_jogo': id_jogo,
            },
            dataType: 'json',
            
            // resposta que vai receber do servidor
            success: function(carta) {
                console.log(carta)
                var div = document.getElementById('gerar-frase');
                div.innerHTML =  "<p>"+carta.jogador+"</p>";
                div.innerHTML +=  "<p>"+carta.Frase+"</p>";
                div.innerHTML +=  "<p>"+"ou"+"</p>";
                div.innerHTML +=  "<p>"+"beba:  "+carta.doses+" </p>";
                $("#id_feito").attr("onclick","pontuacao(2,"+jogador+")");
                $("#id_passa").attr("onclick","pontuacao(1,"+jogador+")");       
            }
        });
    }
    function pontuacao(ponto,jogador){
        $.ajax({
            // o que vai ser enviado ao servidor/ views
            url:'/gravar_ponto/',
            data: {
                'ponto': ponto,                
                'jogador' : jogador,                
            },
            dataType: 'json',
            
            // resposta que vai receber do servidor
            success: function(carta) {
                console.log(carta)
                if (ultimo == n){
                    n = 0;
                }
                else{
                    n += 1
                }
                jogadas +=1 
                // if(limite_Jogadas >= njogadas){

                // }
                
                getCarta(listJogadores[n]);                     
            }
            
        });
    }

        
  </script>
 
{%endblock conteudo%}